@page "/entries"
@using DailyNotes.Models
@inject DailyNotes.Services.EntryService entryService
@inject DailyNotes.Services.AuthStateService AuthStateService
@inject NavigationManager nav
@attribute [Authorize]

<h2 class="page-title">My Entries</h2>

<div class="entry-list">
    @if (myEntries.Count == 0)
    {
        <p>You haven't written anything yet.</p>
    }
    @foreach (var entry in myEntries)
    {
        <div class="entry-card">
            <h4>@entry.Title</h4>
            <p>@(entry.Content.Length > 100 ? entry.Content.Substring(0, 100) + "..." : entry.Content)</p>
            <small>@entry.CreatedAt.ToShortDateString()</small>

            <div class="card-actions">
                <button class="secondary-btn" @onclick="() => EditEntry(entry.Id)">âœï¸ Edit</button>
                <button class="danger-btn" @onclick="() => DeleteEntry(entry.Id)">ğŸ—‘ Delete</button>
            </div>
        </div>
    }
</div>

@code {
    List<Entry> myEntries = new();

    protected override async Task OnInitializedAsync()
    {
        await AuthStateService.EnsureInitializedAsync();
        myEntries = await entryService.GetMyEntriesAsync();
    }

    void EditEntry(string id) => nav.NavigateTo($"/editentry/{id}");

    async Task DeleteEntry(string id)
    {
        await entryService.DeleteEntryAsync(id);
        myEntries = await entryService.GetMyEntriesAsync();
    }
}