@page "/editentry/{id}"
@using DailyNotes.Models
@inject DailyNotes.Services.EntryService entryService
@inject DailyNotes.Services.AuthStateService AuthStateService
@inject NavigationManager nav
@attribute [Authorize]

<h2 class="page-title">Edit Entry</h2>

@if (entry == null)
{
    <p>Loading...</p>
}
else
{
    <div class="form-box">
        <label>Title</label>
        <input class="text-input" @bind="entry.Title" />

        <label>Content</label>
        <textarea class="text-area" rows="8" @bind="entry.Content"></textarea>

        <label class="switch-label">
            <input type="checkbox" @bind="entry.IsPublic" />
            <span>Public</span>
        </label>

        <button class="primary-btn" @onclick="UpdateEntry">Update Entry</button>
    </div>
}

@code {
    [Parameter] public string id { get; set; } = string.Empty;

    Entry? entry;

    protected override async Task OnInitializedAsync()
    {
        await AuthStateService.EnsureInitializedAsync();
        entry = await entryService.GetEntryByIdAsync(id);
    }

    async Task UpdateEntry()
    {
        if (entry is null)
            return;

        await entryService.UpdateEntryAsync(entry);
        nav.NavigateTo("/entries");
    }
}